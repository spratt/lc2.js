<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>lc2.js</title>
    <link rel="stylesheet" type="text/css"
          href="http://fonts.googleapis.com/css?family=Open+Sans" >
    <link rel="stylesheet" type="text/css" 
          href="http://spratt.github.io/EasyCSS/readabilitysans.css" />
    <link rel="stylesheet" type="text/css" 
          href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/codemirror.min.css" />
    <link rel="stylesheet" type="text/css" 
          href="docs/style.css" />
    <style type="text/css">
      .error, .pc {width: .8em;}
      h1, h3 { display: inline; }
      h1 a { text-decoration: none; }
      h1 a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <h1><a href="index.html">lc2.js</a></h1>
    <h3>By <a href="http://pr4tt.com">Simon Pratt</a></h3>
    <p>
      A simulator of
      the <a href="http://www.cs.utexas.edu/users/fussell/courses/cs310h/simulator/lc2.pdf">LC-2</a>
      in javascript.  See the 
      <a href="docs/index.html">documentation</a>,
      and <a href="tests/index.html">unit tests</a>.
    </p>
    <p>
      <textarea id="editor"></textarea>
      <button id="assemble">Assemble</button>
      <select id="loader">
        <option value="asm/helloworld.asm">helloworld.asm</option>
        <option value="asm/test_console.asm">test_console.asm</option>
        <option value="asm/traps.asm">traps.asm</option>
        <option value="asm/in.asm">in.asm</option>
        <option value="tests/reverse.asm">reverse.asm</option>
        <option value="tests/dumbadd.asm">dumbadd.asm</option>
        <option value="tests/justtest.asm">justtest.asm</option>
      </select>
      <span id="errors" style="float: right"></span>
      <br />
      <div id="lc2"></div>
    </p>
    <p>
      <a href="https://github.com/spratt/lc2.js">Source code</a>
      available under <a href="http://opensource.org/licenses/ISC">the
      ISC license</a>.
    </p>
    <a href="https://github.com/spratt/lc2.js">
      <img style="position: absolute; top: 0; right: 0; border: 0;" alt="Fork me on GitHub"
           src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png">
    </a>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/addon/mode/simple.min.js"></script>
    <script src="lc2mode.js"></script>
    <script src="lc2.js"></script>
    <script src="lexer.js"></script>
    <script src="lib.js"></script>
    <script src="lc2asm.js"></script>
    <script src="lc2editor.js"></script>
    <script src="lc2display.js"></script>
    <script>
      var errors = document.getElementById('errors');
      var editor = LC2.editorFromTextArea(document.getElementById('editor'));
      editor.onError = function(err) {
          errors.innerHTML = err.message + ' on line ' + err.line;
      };
      editor.onChange = function(change) {
          errors.innerHTML = '&nbsp;';
      };
      var displayDiv = document.getElementById('lc2');
      //var lc2inst;
      var display;
      function reset() {
          displayDiv.innerHTML = '';
          lc2inst = new LC2;
          try {
              var traps = LC2.assemble(lib.readFromURL('asm/traps.asm'));
              lc2inst.load_program(traps);
              var in_prg = LC2.assemble(lib.readFromURL('asm/in.asm'));
              lc2inst.load_program(in_prg);
          } catch(err) {
              console.error('Error while loading service routines', err);
          }
          lc2inst.pc.val = parseInt('3000', 16);
          display = lc2inst.displayFromDiv(displayDiv);
          display.update();
      }
      function loaderChange() {
          var path = loader.options[loader.selectedIndex].value;
          editor.setValue(lib.readFromURL(path));
          reset();
          editor.assemble(handleProgram);
      }
      loaderChange();
      document.getElementById('loader').addEventListener('change',
                                                         loaderChange);
      function handleProgram(prg) {
          lc2inst.load_program(prg);
          display.update();
      }
      document.getElementById('assemble').addEventListener('click',function(){
          reset();
          editor.assemble(handleProgram);
      });
    </script>
  </body>
</html>
